{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the DreamVault application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL to the user's profile picture.",
          "format": "uri"
        },
        "oauthProvider": {
          "type": "string",
          "description": "The OAuth provider used for authentication (e.g., 'Google', 'Facebook')."
        },
        "oauthId": {
          "type": "string",
          "description": "The user's ID from the OAuth provider."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName",
        "oauthProvider",
        "oauthId"
      ]
    },
    "Couple": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Couple",
      "type": "object",
      "description": "Represents a couple in the DreamVault application, linking two users together.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Couple entity."
        },
        "user1Id": {
          "type": "string",
          "description": "Reference to User 1. (Relationship: User 1:1 Couple)"
        },
        "user2Id": {
          "type": "string",
          "description": "Reference to User 2. (Relationship: User 1:1 Couple)"
        },
        "creationDate": {
          "type": "string",
          "description": "The date when the couple was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "user1Id",
        "user2Id",
        "creationDate"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a financial transaction recorded in the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Transaction entity."
        },
        "coupleId": {
          "type": "string",
          "description": "Reference to Couple. (Relationship: Couple 1:N Transaction)"
        },
        "date": {
          "type": "string",
          "description": "Date of the transaction.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction."
        },
        "description": {
          "type": "string",
          "description": "Description of the transaction."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Transaction)"
        }
      },
      "required": [
        "id",
        "coupleId",
        "date",
        "amount",
        "description",
        "categoryId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for classifying financial transactions.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Category entity."
        },
        "coupleId": {
          "type": "string",
          "description": "Reference to Couple. (Relationship: Couple 1:N Category)"
        },
        "name": {
          "type": "string",
          "description": "Name of the category (e.g., 'Leisure', 'Home', 'Food')."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        }
      },
      "required": [
        "id",
        "coupleId",
        "name",
        "description"
      ]
    },
    "GoalBucket": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GoalBucket",
      "type": "object",
      "description": "Represents a shared goal bucket for a couple's dreams and projects.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GoalBucket entity."
        },
        "coupleId": {
          "type": "string",
          "description": "Reference to Couple. (Relationship: Couple 1:N GoalBucket)"
        },
        "name": {
          "type": "string",
          "description": "Name of the goal bucket (e.g., 'Our Trip', 'New Apartment')."
        },
        "targetAmount": {
          "type": "number",
          "description": "Target amount for the goal."
        },
        "currentAmount": {
          "type": "number",
          "description": "Current amount saved towards the goal."
        },
        "description": {
          "type": "string",
          "description": "Description of the goal bucket."
        },
        "startDate": {
          "type": "string",
          "description": "Start date for the goal.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date for the goal.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "coupleId",
        "name",
        "targetAmount",
        "currentAmount",
        "description",
        "startDate",
        "endDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the user can access their own data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}",
        "definition": {
          "entityName": "Couple",
          "schema": {
            "$ref": "#/backend/entities/Couple"
          },
          "description": "Stores couple information, linking two users together.",
          "params": [
            {
              "name": "coupleId",
              "description": "The unique identifier of the couple."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores transaction data for a specific couple. Includes denormalized 'coupleId' for authorization independence.",
          "params": [
            {
              "name": "coupleId",
              "description": "The unique identifier of the couple."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier of the transaction."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores categories for transactions, specific to a couple. Includes denormalized 'coupleId' for authorization independence.",
          "params": [
            {
              "name": "coupleId",
              "description": "The unique identifier of the couple."
            },
            {
              "name": "categoryId",
              "description": "The unique identifier of the category."
            }
          ]
        }
      },
      {
        "path": "/couples/{coupleId}/goalBuckets/{goalBucketId}",
        "definition": {
          "entityName": "GoalBucket",
          "schema": {
            "$ref": "#/backend/entities/GoalBucket"
          },
          "description": "Stores goal bucket data for a specific couple. Includes denormalized 'coupleId' for authorization independence.",
          "params": [
            {
              "name": "coupleId",
              "description": "The unique identifier of the couple."
            },
            {
              "name": "goalBucketId",
              "description": "The unique identifier of the goal bucket."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support a collaborative finance management application for couples, focusing on shared goals and transactions. The core principle is Authorization Independence, achieved through denormalization. Each data entity is structured to facilitate simple and secure security rules. The structure also incorporates Structural Segregation to maintain a homogeneous security posture within each collection. The use of hierarchical paths reinforces clear ownership and relationships between entities. OAuth integration is supported through the `User` entity's `oauthProvider` and `oauthId` fields.\n\nAuthorization Independence:\n\n*   Transactions, Categories and GoalBuckets are stored under a `couples` collection. This requires duplicating the `coupleId` on the document itself and avoids the need for `get()` calls to parent documents during authorization.\n\nQAPs (Queries are not Filters):\n\n*   The segregation of data into collections based on entity type (Users, Couples, Transactions, Categories, GoalBuckets) allows for efficient and secure list operations. Queries can be scoped to specific collections, and security rules can be applied at the collection level without needing to filter based on document content.\n\nData Clarity and Predictability:\n\n*   Consistent naming conventions are used for fields (e.g., `coupleId`, `id`). This ensures clarity and predictability when writing security rules and application code."
  }
}